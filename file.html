<html>
<head>
    <meta charset="utf-8">
</head>
<body>
<input type="file" id="file" name="file" />
<div id=f></div>
<pre id=o></pre>
<script>
var output = {};

function updateInput(id,value) {
    updateInput2(id,value,output);
    const x = JSON.stringify(output, null, 2);
    document.getElementById("o").innerHTML = x;
}

function updateInput2(id,value,out) {
    var idObj = id.split(",");
    if (idObj.length==1) {
        console.log("length 1"+idObj[0]);
        out [idObj[0]]=value;
    } else {
	var idObj2 = id.split(",");
	idObj2.shift();
        console.log("idobj "+idObj);
	var info = idObj[0].split(/[\[,\]]/);
    	updateInput2(idObj2.toString(),value,out[info[0]][info[1]]);
    }
}

function parseJson(json,out,id) {
    var retVal="";
    for (var i in json) {
	if (json[i][0]=="a") {	
	    var id2=id.slice();
	    id2.push(i);	
	    retVal+=i+"<input type=button value='add'>id "+JSON.stringify(id2)+"<br>";
	    var arr = [];
	    out[i] = arr;
	    var arrEl = {};
	    console.log(out);	   	 
	    var id2=id.slice();
	    id2.push(i+"[0]");	       
	    r=parseJson(json[i][1],arrEl,id2);
	    retVal+=r[0];
	     arr.push( r[1]);
        } else if (json[i][0]=="s") {
	    var id2=id.slice();
	    id2.push(i);
	    retVal+=i+"<input oninput=updateInput('"+id2.toString()+"',this.value);>id "+JSON.stringify(id2)+"<br>";
	    var el = "";
	    out[i] = el;
	}
    }
    return [retVal+"<br>",out];
}

function createPage(jsonTxt) {
    const d = parseJson(JSON.parse(jsonTxt),output,[]);
    output = d[1];
    console.log(d);
    console.log(d[1]);
    document.getElementById("f").innerHTML=d[0];
    const x = JSON.stringify(output, null, 2);
    document.getElementById("o").innerHTML = x;
}

document.getElementById("file").addEventListener("change",
    function(evt) {
	const fReader = new FileReader();
        fReader.onload = function(e) {
	    createPage(e.target.result);
        };
        fReader.readAsText(evt.target.files[0]);
    });
</script>
</body>
</html>
